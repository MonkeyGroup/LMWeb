@using LM.Model.Common
@using LM.Model.Model
@using LM.Utility
@using LM.WebUI.Areas.Admin.Models
@{
    Layout = "~/Areas/Admin/Views/Shared/_Main.cshtml";
    ViewBag.Title = "List";

    var models = ViewBag.Companies as List<CompanyModel>;
    var catList = ViewBag.CatList as List<CategoryModel>;
    var pageInfo = (ViewBag.PageInfo as PageInfo) ?? new PageInfo();

    var index = 1;
    var type = ViewBag.Type ?? "";
    var range = ViewBag.Range;
    var keys = ViewBag.Keys ?? "";
}
@Html.RenderScript("/Areas/Admin/Content/js/laypage/laypage.js")

<script>
    $(function () {
        /* 分页使用异步 */
        laypage({
            cont: document.getElementById('pageDiv1'), //容器。值支持id名、原生dom对象，jquery对象,
            pages: '@pageInfo.PageCount', //总页数
            curr: '@pageInfo.PageIndex', // 当前页
            groups: 3, //连续显示分页数
            skin: '#0072C6',
            jump: function (e, first) {
                // 第一次的事件必须要判断
                if (!first) {
                    var type = $('#type').val();
                    var range = $('#range').val();
                    var keys = $('#keys').val();
                    window.location.href = '/Admin/Company/List?&pindex=' + e.curr + (type !== '' ? '&type=' + type : '')
                        + (range !== '' ? '&range=' + range : '') + (keys !== '' ? '&keys=' + keys : '');
                }
            }
        });
    });
</script>

<script>
    function search() {
        var type = $('#type').val();
        var range = $('#range').val();
        var keys = $('#keys').val();
        window.location.href = '/Admin/Company/List?type=' + type + '&range=' + range + '&keys=' + keys;
    }

    function delArticle(id) {
        if (!confirm('确定删除吗？'))
            return;
        var type = $('#type').val();
        var range = $('#range').val();
        var keys = $('#keys').val();
        window.location.href = '/Admin/Company/Delete?ids=' + id + '&type=' + type + '&range=' + range + '&keys=' + keys;
    }

    function batchDelete(form) {
        if (!confirm('确定删除吗？'))
            return;
        var ids = [];
        for (var i = 0; i < form.elements.length; i++) {
            var e = form.elements[i];
            if (e.name !== "chkall" && e.type !== "button" && e.disabled !== true && e.checked) {
                e.value != null && ids.push(Number(e.value));
            }
        }
        if (ids.length === 0) {
            alert('请勾选删除项！');
        } else {
            var type = $('#type').val();
            var range = $('#range').val();
            var keys = $('#keys').val();
            window.location.href = '/Admin/Company/Delete?ids=' + ids + '&type=' + type + '&range=' + range + '&keys=' + keys;
        }
    }

</script>

<div id="dcMain">
    <!-- 当前位置 -->
    <div id="urHere">
        后台管理中心<b>></b><strong>成员列表</strong>
    </div>

    <div class="mainBox" style="height: auto !important; height: 550px; min-height: 550px;">
        <h3>
            <a href="/Admin/Company/Company" class="actionBtn add">添加成员</a>成员列表
        </h3>
        <div class="filter">
            <form method="post">
                <select id="type" name="type">
                    <option value=""> 未分类</option>
                    <option value="@((int) MemberType.上游企业)" @((int)MemberType.上游企业 + "" == type ? "selected" : "")> @MemberType.上游企业</option>
                    <option value="@((int) MemberType.下游企业)" @((int)MemberType.下游企业 + "" == type ? "selected" : "")> @MemberType.下游企业</option>
                    <option value="@((int) MemberType.科研院所协会)" @((int)MemberType.科研院所协会 + "" == type ? "selected" : "")> @MemberType.科研院所协会</option>
                </select>
                <select id="range" name="range">
                    <option value="0"> 未分类</option>
                    @foreach (var cat in catList)
                    {
                        <option value="@cat.Id" @(cat.Id == range ? "selected" : "")>@cat.Name</option>
                    }
                </select>
                <input id="keys" name="keys" type="text" class="inpMain" value="@keys" size="20" placeholder="输入成员名称关键字" />
                <input name="submit" class="btnGray" type="button" value="筛选" onclick="return search() && false;" />
            </form>
        </div>
        <div id="list">
            <form name="action">
                <table width="100%" border="0" cellpadding="8" cellspacing="0" class="tableBasic">
                    @if (models != null && models.Count > 0)
                    {
                        <tr>
                            <th width="22" align="center">
                                <input name='chkall' type='checkbox' id='chkall' onclick='selectcheckbox(this.form)' value='check'>
                            </th>
                            <th width="40" align="center">编号</th>
                            <th align="center">成员名称</th>
                            <th width="120" align="center">官网地址</th>
                            <th width="120" align="center">Logo 路径</th>
                            <th width="100" align="center">成员分类</th>
                            <th width="100" align="center">成员头衔</th>
                            <th width="100" align="center">保存时间</th>
                            <th width="80" align="center">操作</th>
                        </tr>

                        foreach (var model in models)
                        {
                            <tr>
                                <td align="center">
                                    <input type="checkbox" name="checkbox" value="@(model.Id)" />
                                </td>
                                <td align="center">
                                    @((pageInfo.PageIndex - 1) * pageInfo.PageSize + index++)
                                </td>
                                <td>
                                    <a href="/Admin/Company/Company?id=@(model.Id)">@(model.Name)</a>
                                </td>
                                <td align="center">
                                    <a href="@(!string.IsNullOrEmpty(model.Site) ? string.Format(@"javascript:window.open('{0}')", model.Site) : "#")"
                                       target="_blank">@(model.Site)</a>
                                </td>
                                <td align="center">
                                    @(model.LogoSrc)
                                </td>
                                <td align="center">
                                    @(model.Type.ToString())
                                </td>
                                <td align="center">
                                    @(model.RangeName)
                                </td>
                                <td align="center">
                                    @(model.SaveAt.ToString("yyyy-MM-dd HH:mm:ss"))
                                </td>
                                <td align="center">
                                    <a href="/Admin/Company/Company?id=@(model.Id)">编辑</a> | <a href="#" onclick="return delArticle('@(model.Id)') && false;">删除</a>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <th width="22" align="center">
                                <span style="text-align: center;">无数据！</span>
                            </th>
                        </tr>
                    }
                </table>

                <div class="action">
                    <button name="" class="btn" type="button" value="删除" onclick="return batchDelete(this.form) && false;">删除</button>
                    <!--分页-->
                    <div class="pageDiv" id="pageDiv1" style="float: right;"></div>
                </div>
            </form>
        </div>
        <div class="clear"></div>
    </div>
</div>

<script type="text/javascript">
    onload = function () {
        document.forms['action'].reset();
    }
</script>

















